FROM node:22-alpine as build

WORKDIR /usr/src/app

COPY package*.json ./

RUN npm install

COPY ./ ./

RUN npm run build

FROM node:22-alpine

RUN apk update && apk upgrade && apk add curl

USER node

WORKDIR /usr/src/app

COPY --chown=node:node --from=build /usr/src/app .
COPY --chown=node:node .env .env

EXPOSE 80

HEALTHCHECK CMD curl -f http://localhost:80/healthz || exit 1

CMD ["npm", "run", "start"]
